server {
    root /home/isucon/isucon10-qualify/webapp/public;
    listen 80 default_server;
    listen [::]:80 default_server;

    if ($http_user_agent ~* (ISUCONbot(-Mobile)?)) {
        return 503;
    }

    if ($http_user_agent ~* (ISUCONbot-Image\/)) {
        return 503;
    }

    if ($http_user_agent ~* (ISUCONCoffee|isubot|Isupider|Mediapartners-ISUCON)) {
        return 503;
    }

    if ($http_user_agent ~* (ISUCONFeedSeeker(Beta)?)) {
        return 503;
    }

    if ($http_user_agent ~* (crawler \(https:\/\/isucon\.invalid\/(support\/faq\/|help\/jp\/))) {
        return 503;
    }

    if ($http_user_agent ~* (Isupider(-image)?\+)) {
        return 503;
    }

    #if ($http_user_agent ~* ((bot|crawler|spider)(?:[-_ .\/;@()]|$))) {
    #    return 503;
    #}


    location /api {
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Host $http_host;
        proxy_pass http://app-all;
    }

    location /initialize {
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Host $http_host;
        proxy_pass http://app-initialize;
    }

    location / {
            root /www/data;
    }
}